// Generated by CoffeeScript 1.9.0
(function() {
  var HTTPParser, Transform, fs, listenCallback, methods, net, server;

  fs = require('fs');

  net = require('net');

  HTTPParser = process.binding('http_parser').HTTPParser;

  methods = HTTPParser.methods;

  Transform = require('stream').Transform;

  server = net.createServer(function(socket) {
    var closeSocket, connectSocket, connectionSocket, dataSocket, errorSocket, parser;
    parser = new HTTPParser(HTTPParser.remoteAddress);
    console.log('parserServer', parser);
    socket.on('connection', connectionSocket = function() {
      return console.log('socket : connection' + socket.remoteAddress(+':' + socket.remotePort));
    });
    socket.on('connect', connectSocket = function() {
      return console.log('socket : connect');
    });
    socket.on('data', dataSocket = function(data) {
      var parser2;
      console.log('socket : DATA ' + socket.remoteAddress + ': ' + data);
      socket.write('socket :you said ' + data);
      parser2 = new HTTPParser(HTTPParser.remoteAddress);
      return console.log('parser2', parser2);
    });
    socket.on('error', errorSocket = function() {
      return console.log('socket : error');
    });
    return socket.on('close', closeSocket = function() {
      return console.log('socket : close');
    });
  });

  server.listen(8124, '10.0.0.80', listenCallback = function() {
    var address, closeServer, connectionServer;
    address = server.address();
    console.log('server bound', address);
    server.on('connection', connectionServer = function(sock) {
      var closeSocket, connectSocket, dataSocket, errorSocket, remoteAddress, remotePort;
      remoteAddress = sock.remoteAddress;
      remotePort = sock.remotePort;
      console.log('server : connection ', remoteAddress, remotePort);
      sock.on('connect', connectSocket = function() {
        return console.log('socket inside: connect');
      });
      sock.on('data', dataSocket = function(data) {
        var parser;
        parser = new Transform();
        parser._transform(function(data, encoding, done) {
          this.push(data);
          return done();
        });
        console.log('sock : DATA ', 'encoding', sock.remoteAddress, ': ', data);
        sock.write('sock : you said \n' + data);
        return sock.pipe(parser);
      });
      sock.on('error', errorSocket = function() {
        return console.log('socket inside: error');
      });
      return sock.on('close', closeSocket = function() {
        return console.log('socket inside: close');
      });
    });
    return server.on('close', closeServer = function() {
      return console.log('server : close');
    });
  });

}).call(this);
